import{c as E,b as D,s as c,d as Q,u as W,r as x,e as B,f as H,j as t,a as m,B as V,V as g}from"./index-DscStW3j.js";import{S as b}from"./SEO-6FDy1d8K.js";import{P as K}from"./ProductCard-DTuOKA55.js";import{A as C}from"./arrow-left-5Ry7Ws-8.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=E("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=E("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);function J(i){return D({queryKey:["similarProducts",i],queryFn:async()=>{const{data:n,error:e}=await c.from("Products").select("embedding").eq("Product_ID",i).single();if(e)throw e;const{data:l,error:p}=await c.rpc("match_products",{query_embedding:n.embedding,match_threshold:.5,match_count:5});if(p)throw p;return l.filter(r=>r.Product_ID!==i).map(r=>({id:r.Product_ID,name:r.Product_Title,Product_Price:r.Product_Price,image:r.Product_Image_URL||"",country:r.country_title||"Unknown",category:r.category_title||"Unknown",supplier:r.supplier_title||"Unknown",Product_MOQ:r.Product_MOQ,sourceUrl:r.Product_Title_URL||"",marketplace:r.source_title||"Unknown"}))},staleTime:1e3*60*60})}function re(){const{id:i}=Q(),n=W(),[e,l]=x.useState(null),[p,r]=x.useState(!0),[f]=x.useState(()=>/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)),{data:I=[],toggleSavedItem:$}=B(),{recordContact:U}=H(),{data:_=[],isLoading:X}=J(i||""),d=I.some(s=>s.id===(e==null?void 0:e.id));x.useEffect(()=>{async function s(){var o,h,v,P,k,w;if(!i){r(!1);return}try{const{count:y,error:N}=await c.from("Products").select("Product_ID",{count:"exact",head:!0}).eq("Product_ID",i);if(N){console.error("Error checking product existence:",N),r(!1);return}if(y===0){l(null),r(!1);return}const{data:a,error:S}=await c.from("Products").select(`
            Product_ID,
            Product_Title,
            Product_Price,
            Product_Image_URL,
            Product_Title_URL,
            Product_MOQ,
            Countries (
              Country_Title
            ),
            Categories (
              Category_Title
            ),
            Supplier (
              Supplier_Title,
              Supplier_Email,
              Supplier_Whatsapp
            ),
            Sources (
              Source_Title
            )
          `).eq("Product_ID",i).maybeSingle();if(S){console.error("Error fetching product:",S);return}if(a){const u={id:a.Product_ID,name:a.Product_Title,Product_Price:a.Product_Price,image:a.Product_Image_URL||"",country:((o=a.Countries)==null?void 0:o.Country_Title)||"Unknown",category:((h=a.Categories)==null?void 0:h.Category_Title)||"Unknown",supplier:((v=a.Supplier)==null?void 0:v.Supplier_Title)||"Unknown",supplierEmail:((P=a.Supplier)==null?void 0:P.Supplier_Email)||"",supplierWhatsapp:((k=a.Supplier)==null?void 0:k.Supplier_Whatsapp)||"",Product_MOQ:a.Product_MOQ,sourceUrl:a.Product_Title_URL||"",marketplace:((w=a.Sources)==null?void 0:w.Source_Title)||"Unknown"};l(u),m.trackEvent("product_view",{props:{product_id:u.id,product_name:u.name,product_category:u.category,product_country:u.country}})}else l(null)}catch(y){console.error("Error:",y)}finally{r(!1)}}s()},[i]);const A=()=>{if(!e)return;const s=window.location.href,o=`I found this product on Pais치n.

${e.name}

${s}`;if(f)window.location.href=`sms:?body=${encodeURIComponent(o)}`;else{const h=encodeURIComponent("Check out this product on Pais치n");window.location.href=`mailto:?subject=${h}&body=${encodeURIComponent(o)}`}m.trackEvent("product_share",{props:{product_id:e.id,product_name:e.name,share_method:f?"sms":"email"}})},F=async()=>{if(e)try{const{data:{session:s}}=await c.auth.getSession();if(!s){g.error("Please log in to save items");return}await $(e),g.success(d?"Item removed from saved items":"Item saved successfully"),m.trackEvent(d?"item_unsaved":"item_saved",{props:{product_id:e.id,product_name:e.name}})}catch(s){console.error("Error saving item:",s),g.error("Failed to save item. Please try again.")}},T=async s=>{if(e)try{const{data:{session:o}}=await c.auth.getSession();if(!o){g.error("Please log in to contact suppliers");return}await U(e.id,s),m.trackEvent("contact_supplier_click",{props:{product_id:e.id,product_name:e.name,supplier:e.supplier,contact_method:s}})}catch(o){console.error("Error recording contact:",o)}};if(p)return t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"text-[#F4A024]",children:"Loading product..."})});if(!e)return t.jsxs(t.Fragment,{children:[t.jsx(b,{title:"Product Not Found",description:"The requested product could not be found. Browse our other Latin American products."}),t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-100",children:"Product not found"}),t.jsxs("button",{onClick:()=>n("/"),className:"mt-4 inline-flex items-center text-[#F4A024] hover:text-[#F4A024]",children:[t.jsx(C,{className:"w-5 h-5 mr-2"}),"Back to Home"]})]})})]});const j=window.location.href,L=encodeURIComponent(e.name),M=encodeURIComponent(`Hello, I am interested in this product that you offer. I found the listing from Pais치n:

${e.name}
${j}`),R=encodeURIComponent(`Hello, I am interested in this product that you offer. I found the listing from Pais치n:

${e.name}
${j}`),q=()=>e.supplierEmail?`mailto:${e.supplierEmail}?subject=${L}&body=${M}`:e.supplierWhatsapp?`https://wa.me/${e.supplierWhatsapp.replace(/\D/g,"")}?text=${R}`:"#",O=()=>e.supplierEmail?"Contact Supplier via Email":e.supplierWhatsapp?"Contact Supplier via WhatsApp":"Contact Supplier";return t.jsxs(t.Fragment,{children:[t.jsx(b,{title:e.name,description:`Buy ${e.name} from ${e.supplier}. ${e.category} products from ${e.country}. MOQ: ${e.Product_MOQ} units.`,keywords:`${e.name}, ${e.category}, ${e.country}, ${e.supplier}, wholesale, B2B, Latin American products`,image:e.image,type:"product"}),t.jsx("div",{className:"pt-24 pb-16 px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("button",{onClick:()=>n("/"),className:"inline-flex items-center text-[#F4A024] hover:text-[#F4A024]",children:[t.jsx(C,{className:"w-5 h-5 mr-2"}),"Back to Products"]}),t.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 text-[#F4A024] hover:text-[#F4A024]/80",title:`Share via ${f?"SMS":"email"}`,children:[t.jsx(G,{className:"w-5 h-5"}),t.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[t.jsx("div",{className:"aspect-square overflow-hidden rounded-lg bg-gray-800/50","data-tour":"product-details",children:t.jsx("img",{src:e.image,alt:e.name,className:"h-full w-full object-cover object-center"})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-100",children:e.name}),t.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[t.jsx("p",{className:"text-xl text-[#F4A024]",children:e.Product_Price}),t.jsx("span",{className:"px-2 py-1 bg-gray-800 rounded-full text-sm text-gray-300",children:e.category})]})]}),t.jsxs("div",{className:"space-y-4 text-gray-300",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-100",children:"Country"}),t.jsx("p",{className:"mt-1",children:e.country})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-100",children:"Category"}),t.jsx("p",{className:"mt-1",children:e.category})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-100",children:"MOQ"}),t.jsxs("p",{className:"mt-1",children:[e.Product_MOQ," units"]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-100",children:"Supplier"}),t.jsx("button",{onClick:()=>n(`/supplier/${e.supplier}`),className:"mt-1 text-left text-[#F4A024] hover:text-[#F4A024]",children:e.supplier})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-100",children:"Original Source"}),t.jsxs("a",{href:e.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"mt-1 inline-flex items-center text-[#F4A024] hover:text-[#F4A024]",onClick:()=>{m.trackEvent("source_link_click",{props:{product_id:e.id,product_name:e.name,marketplace:e.marketplace}})},children:["View on ",e.marketplace,t.jsx(z,{className:"w-4 h-4 ml-1"})]})]})]}),(e.supplierEmail||e.supplierWhatsapp)&&t.jsxs("div",{className:"flex gap-4",children:[t.jsx("a",{href:q(),className:"btn-primary flex-1 py-3 text-center block","data-tour":"contact-supplier",onClick:()=>T(e.supplierEmail?"email":"whatsapp"),target:e.supplierWhatsapp?"_blank":void 0,rel:e.supplierWhatsapp?"noopener noreferrer":void 0,children:O()}),t.jsxs("button",{onClick:F,className:`px-6 py-3 rounded-md transition-colors flex items-center justify-center gap-2 ${d?"bg-gray-800 text-[#F4A024]":"bg-gray-800 text-gray-300 hover:text-[#F4A024]"}`,children:[t.jsx(V,{className:"w-5 h-5",fill:d?"currentColor":"none"}),t.jsx("span",{className:"sr-only",children:d?"Remove from saved":"Save item"})]})]})]})]}),_.length>0&&t.jsxs("div",{className:"mt-16",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-8",children:"Customers who viewed this also looked at..."}),t.jsx("div",{className:"grid grid-cols-1 gap-y-10 gap-x-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:_.map(s=>t.jsx(K,{product:s},s.id))})]})]})})]})}export{re as default};
