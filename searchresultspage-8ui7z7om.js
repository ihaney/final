import{g as k,u as E,r as p,j as e,C as I,L as R,s as f,p as q,l as v}from"./index-DscStW3j.js";import{S as O}from"./SEO-6FDy1d8K.js";import{P as L}from"./ProductCard-DTuOKA55.js";import{A as U}from"./arrow-left-5Ry7Ws-8.js";function Q(){const[g]=k(),_=E(),a=g.get("q")||"",n=g.get("category"),i=g.get("source"),l=g.get("country"),[h,D]=p.useState([]),[P,y]=p.useState(!0),[j,A]=p.useState(0),[x,T]=p.useState(null),[o,N]=p.useState({suppliers:{title:"Suppliers",options:[],selected:[]},sources:{title:"Sources",options:[],selected:[]},countries:{title:"Countries",options:[],selected:[]}});p.useEffect(()=>{async function r(){y(!0);try{let c="";const t=[];if(n){const{data:s}=await f.from("Categories").select("Category_Title").eq("Category_ID",n).single();s&&t.push(`category = "${s.Category_Title}"`)}if(i){const{data:s}=await f.from("Sources").select("Source_Title").eq("Source_ID",i).single();s&&t.push(`source = "${s.Source_Title}"`)}if(l){const{data:s}=await f.from("Countries").select("Country_Title").eq("Country_ID",l).single();s&&t.push(`country = "${s.Country_Title}"`)}o.suppliers.selected.length>0&&t.push(`supplier IN [${o.suppliers.selected.map(s=>`"${s}"`).join(", ")}]`),o.sources.selected.length>0&&t.push(`source IN [${o.sources.selected.map(s=>`"${s}"`).join(", ")}]`),o.countries.selected.length>0&&t.push(`country IN [${o.countries.selected.map(s=>`"${s}"`).join(", ")}]`),c=t.join(" AND ");const d=await q.search(a,{filter:c,limit:100,facets:["supplier","source","country"]});A(d.estimatedTotalHits||0),N(s=>{var S,C,$;return{suppliers:{...s.suppliers,options:Object.entries(((S=d.facetDistribution)==null?void 0:S.supplier)||{}).map(([u,m])=>({id:u,title:u,count:m}))},sources:{...s.sources,options:Object.entries(((C=d.facetDistribution)==null?void 0:C.source)||{}).map(([u,m])=>({id:u,title:u,count:m}))},countries:{...s.countries,options:Object.entries((($=d.facetDistribution)==null?void 0:$.country)||{}).map(([u,m])=>({id:u,title:u,count:m}))}}});const b=d.hits.map(s=>({id:s.id,name:s.title,Product_Price:s.price,image:s.image||"",country:s.country||"Unknown",category:s.category||"Unknown",supplier:s.supplier||"Unknown",Product_MOQ:s.moq,sourceUrl:s.url||"",marketplace:s.source||"Unknown"}));D(b),!b.length&&a.length>2&&v(new Error("Search returned no results"),{type:"search_no_results",query:a,category:n,source:i,country:l},"warning")}catch(c){console.error("Search error:",c),v(c instanceof Error?c:new Error("Search failed"),{type:"search_error",query:a,category:n,source:i,country:l})}finally{y(!1)}}r()},[a,n,i,l,o.suppliers.selected,o.sources.selected,o.countries.selected]);const F=(r,c)=>{N(t=>({...t,[r]:{...t[r],selected:t[r].selected.includes(c)?t[r].selected.filter(d=>d!==c):[...t[r].selected,c]}}))},w=()=>n?`Products in ${n}`:i?`${j.toLocaleString()} Products from ${i}`:l?`Products from ${l}`:a?`Search Results for "${a}"`:"All Products";return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:w(),description:`Browse ${j} products matching your search. Filter by supplier, source, and country.`,keywords:`search results, ${a}, product search, filter products`}),e.jsx("div",{className:"pt-24 pb-16 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>_(-1),className:"inline-flex items-center text-[#F4A024] hover:text-[#F4A024]/80 mb-8",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-100 mb-2",children:w()}),e.jsxs("p",{className:"text-gray-300",children:[h.length," ",h.length===1?"result":"results"," found"]})]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:Object.entries(o).map(([r,c])=>e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>T(x===r?null:r),className:"flex items-center gap-2 px-4 py-2 bg-gray-800/50 rounded-lg text-gray-300 hover:bg-gray-700/50 transition-colors",children:[c.title,c.selected.length>0&&e.jsx("span",{className:"bg-[#F4A024] text-gray-900 text-xs px-2 py-0.5 rounded-full",children:c.selected.length}),e.jsx(I,{className:`w-4 h-4 transition-transform ${x===r?"rotate-180":""}`})]}),x===r&&e.jsx("div",{className:"absolute z-10 mt-2 w-72 bg-gray-800/95 backdrop-blur-sm rounded-lg shadow-lg overflow-hidden",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:c.options.map(t=>e.jsxs("label",{className:"flex items-center justify-between px-4 py-2 hover:bg-gray-700/50 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c.selected.includes(t.id),onChange:()=>F(r,t.id),className:"rounded border-gray-600 text-[#F4A024] focus:ring-[#F4A024]"}),e.jsx("span",{className:"ml-2 text-gray-300",children:t.title})]}),e.jsx("span",{className:"text-gray-400 text-sm",children:t.count})]},t.id))})})]},r))}),P?e.jsx("div",{className:"text-center py-12",children:e.jsx(R,{})}):h.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-y-10 gap-x-6 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-8",children:h.map(r=>e.jsx(L,{product:r},r.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-gray-300",children:["No products found ",n?"in this category":i?"from this source":l?"from this country":a?`for "${a}"`:""]}),e.jsxs("p",{className:"text-gray-400 mt-2",children:["Try ",n?"another category":i?"another source":l?"another country":"searching with different keywords"," or browse our categories"]})]})]})]})})]})}export{Q as default};
